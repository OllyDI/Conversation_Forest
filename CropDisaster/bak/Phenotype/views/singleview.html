<!DOCTYPE html>
<html lang="en">

<head>
    <title>피노타이핑 데이터 분석 가시화 시스템</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
      <!-- Meta -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="description" content="Mega Able Bootstrap admin template made using Bootstrap 4 and it has huge amount of ready made feature, UI components, pages which completely fulfills any dashboard needs." />
      <meta name="keywords" content="bootstrap, bootstrap admin template, admin theme, admin dashboard, dashboard template, admin template, responsive" />
      <meta name="author" content="codedthemes" />
      <!-- Favicon icon -->
      <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">
    <!-- waves.css -->
    <link rel="stylesheet" href="assets/pages/waves/css/waves.min.css" type="text/css" media="all">
      <!-- Required Fremwork -->
      <link rel="stylesheet" type="text/css" href="assets/css/bootstrap/css/bootstrap.min.css">
      <!-- waves.css -->
      <link rel="stylesheet" href="assets/pages/waves/css/waves.min.css" type="text/css" media="all">
      <!-- themify icon -->
      <link rel="stylesheet" type="text/css" href="assets/icon/themify-icons/themify-icons.css">
      <!-- Font Awesome -->
      <link rel="stylesheet" type="text/css" href="assets/icon/font-awesome/css/font-awesome.min.css">
      <!-- scrollbar.css -->
      <link rel="stylesheet" type="text/css" href="assets/css/jquery.mCustomScrollbar.css">
        <!-- am chart export.css -->
        <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
      <!-- Style.css -->
      <link rel="stylesheet" type="text/css" href="assets/css/style.css">
      <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css" rel="stylesheet" />
  </head>

  <body>
  <!-- Pre-loader start -->
  <div class="theme-loader">
      <div class="loader-track">
          <div class="preloader-wrapper">
              <div class="spinner-layer spinner-blue">
                  <div class="circle-clipper left">
                      <div class="circle"></div>
                  </div>
                  <div class="gap-patch">
                      <div class="circle"></div>
                  </div>
                  <div class="circle-clipper right">
                      <div class="circle"></div>
                  </div>
              </div>
              <div class="spinner-layer spinner-red">
                  <div class="circle-clipper left">
                      <div class="circle"></div>
                  </div>
                  <div class="gap-patch">
                      <div class="circle"></div>
                  </div>
                  <div class="circle-clipper right">
                      <div class="circle"></div>
                  </div>
              </div>
            
              <div class="spinner-layer spinner-yellow">
                  <div class="circle-clipper left">
                      <div class="circle"></div>
                  </div>
                  <div class="gap-patch">
                      <div class="circle"></div>
                  </div>
                  <div class="circle-clipper right">
                      <div class="circle"></div>
                  </div>
              </div>
            
              <div class="spinner-layer spinner-green">
                  <div class="circle-clipper left">
                      <div class="circle"></div>
                  </div>
                  <div class="gap-patch">
                      <div class="circle"></div>
                  </div>
                  <div class="circle-clipper right">
                      <div class="circle"></div>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <!-- Pre-loader end -->
  <div id="pcoded" class="pcoded">
      <div class="pcoded-overlay-box"></div>
      <div class="pcoded-container navbar-wrapper">
          <nav class="navbar header-navbar pcoded-header">
              <div class="navbar-wrapper">
                  <div class="navbar-logo">
                      <a class="mobile-menu waves-effect waves-light" id="mobile-collapse" href="#!">
                          <i class="ti-menu"></i>
                      </a>
                      <div class="mobile-search waves-effect waves-light">
                          <div class="header-search">
                              <div class="main-search morphsearch-search">
                                  <div class="input-group">
                                      <span class="input-group-addon search-close"><i class="ti-close"></i></span>
                                      <input type="text" class="form-control" placeholder="Enter Keyword">
                                      <span class="input-group-addon search-btn"><i class="ti-search"></i></span>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <a href="/">
                          <!-- <img class="img-fluid" src="assets/images/logo.png" alt="Theme-Logo" /> -->
                          <h5>메인화면</h5>
                      </a>
                      <a class="mobile-options waves-effect waves-light">
                          <i class="ti-more"></i>
                      </a>
                  </div>
              </div>
          </nav>

          <div class="pcoded-main-container">
              <div class="pcoded-wrapper">
                  <nav class="pcoded-navbar">
                      <div class="sidebar_toggle"><a href="#"><i class="icon-close icons"></i></a></div>
                      <div class="pcoded-inner-navbar main-menu">


                        <div class="pcoded-navigation-label" data-i18n="nav.category.navigation">Layout</div>
                          <ul class="pcoded-item pcoded-left-item">


                              <li>
                                  <a href="/" class="waves-effect waves-dark">
                                      <span class="pcoded-micon"><i class="ti-home"></i><b>연구정리</b></span>
                                      <span class="pcoded-mtext" data-i18n="nav.dash.main">연구 정리</span>
                                      <span class="pcoded-mcaret"></span>
                                  </a>
                              </li>

                              <li>
                                <a href="/search" class="waves-effect waves-dark">
                                    <span class="pcoded-micon"><i class="ti-search"></i><b>D</b></span>
                                    <span class="pcoded-mtext" data-i18n="nav.form-components.main">연구 검색</span>
                                    <span class="pcoded-mcaret"></span>
                                </a>
                              </li>
                          </ul>
                      </div>
                  </nav>
                  <div class="pcoded-content">
                      <!-- Page-header start -->
                      <div class="page-header">
                          <div class="page-block">
                              <div class="row align-items-center">
                                  <div class="col-md-8">
                                      <div class="page-header-title">
                                          <h5 class="m-b-10">피노타이핑 데이터 분석 및 가시화 시스템</h5>
                                      </div>
                                  </div>
                                  <div class="col-md-4">
                                      <ul class="breadcrumb-title">
                                          <li class="breadcrumb-item">
                                              <a href="/"> <i class="fa fa-home"></i> </a>
                                          </li>
                                          <li class="breadcrumb-item"><a href="#!">단일 이미지</a>
                                          </li>
                                      </ul>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <!--여기서부터 시작-->                      
                      <div class="pcoded-inner-content">
                        <!-- Main-body start -->
                        <div class="main-body">
                            <div class="page-wrapper">
                              
                                <!-- Page body start -->
                                <div class="page-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>수치데이터 테이블</h5>
                                                    <div class="card-header-right">
                                                        <ul class="list-unstyled card-option">
                                                            <li><i class="fa fa fa-wrench open-card-option"></i></li>
                                                            <li><i class="fa fa-window-maximize full-card"></i></li>
                                                            <li><i class="fa fa-minus minimize-card"></i></li>
                                                            <li><i class="fa fa-refresh reload-card"></i></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <!-- table start -->
                                                <div class="card-block table-border-style">
                                                    <div class="table-responsive" >
                                                        <table class="table table-hover cell-border text-center " id="tableId">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Name</th>
                                                                    <th>Long axis</th>
                                                                    <th>Short axis</th>
                                                                    <th>area</th>
                                                                    <th>Convex area</th>
                                                                    <th>Center X</th>
                                                                    <th>Center Y</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="table_body">
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <!-- table end -->
                                            </div>

                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>이미지</h5>
                                                    <button id="export_image" onclick="downloadImage()" class="btn btn-primary waves-effect waves-light" style="float: right; padding-bottom: 3px; padding-top: 3px;">내보내기</button>
                                                </div>
                                                <div class="card-block table-border-style">
                                                    <div class="table-responsive" id="selImg" style="text-align: center;">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>연구 설정</h5><br>
                                                </div>
                                                <div class="card-block">
                                                    <div class="form-group row">
                                                        <div class="col-sm-6">
                                                            <div class="row d-flex justify-content-between" style="margin-left: 0px; margin-right: 0px; margin-bottom: 10px;">
                                                                <h3 class="col">라벨 선택</h3>
                                                                <button id="modify_chart_color" class="btn btn-primary waves-effect waves-light" style="float: right; padding-bottom: 3px; padding-top: 3px; margin-left: 3px; margin-right: 3px;">색상변경</button>
                                                                <button id="imgButton" onclick='selectAll(this.id)' class="btn btn-primary waves-effect waves-light" style="float: right; padding-bottom: 3px; padding-top: 3px;">전체선택</button>
                                                            </div>
                                                            <!-- label div start -->
                                                            <div class="form-control" id="label" style="overflow-y:scroll; height: 210px;">
                                                            </div>

                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="row d-flex justify-content-between" style="margin-left: 0px; margin-right: 0px; margin-bottom: 10px;">
                                                                <h3>보기 선택</h3>
                                                                <button id="dataButton" onclick='selectAll(this.id)' class="btn btn-primary waves-effect waves-light" style="float: right; padding-bottom: 3px; padding-top: 3px;">전체선택</button>
                                                            </div>
                                                            <div class="form-control">
                                                                <div class="row">
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_1"> Long axis 차트 </label>
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_2"> Short axis 차트 </label>
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_3"> Area 차트 </label>
                                                                </div>
                                                                <div class="row">
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_4"> Convex_area 차트 </label>
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_5"> Center X 차트 </label>
                                                                    <label class="col-sm-4"><input type="checkbox" name="dataBox" id="datacheck_6">  Center Y 차트 </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-12" id="phenotypeCard">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 


    <div class="modal fade" id="labelModal" tabindex="-1" role="dialog" aria-labelledby="labelModal_topic">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="labelModal_topic">차트 라인 컬러 선택</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times fa-3x"></i></button>
                </div>
                <div class="modal-body" style="text-align: center;">
                    <div class="form-control" id="label_modal"></div>
                    <div id="background_color" style="height: 50px; background: hsl(100, 100%, 50%); margin-top: 30px; margin-bottom: 20px;"></div>
                    <label class="row" id="hue_div" style="margin-left: 10px; margin-right: 10px; margin-top: 20px; margin-bottom: 20px;"><h6>Hue</h6><input class="col-sm-9" id="hue" type="text" style="width: 100%;"></label>
                    <label class="row" id="saturation_div" style="margin-left: 10px; margin-right: 10px; margin-top: 20px; margin-bottom: 20px;"><h6>Saturation</h6><input class="col-sm-9" id="saturation" type="text" style="width: 100%;"></label>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="applyLabelColor()" class="btn btn-default" data-dismiss="modal">적용</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Required Jquery -->
    <script type="text/javascript" src="assets/js/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery-ui/jquery-ui.min.js "></script>
    <script type="text/javascript" src="assets/js/popper.js/popper.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap/js/bootstrap.min.js "></script>
    <script type="text/javascript" src="assets/pages/widget/excanvas.js "></script>
    <!-- waves js -->
    <script src="assets/pages/waves/js/waves.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="assets/js/jquery-slimscroll/jquery.slimscroll.js "></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="assets/js/modernizr/modernizr.js "></script>
    <!-- slimscroll js -->
    <script type="text/javascript" src="assets/js/SmoothScroll.js"></script>
    <script src="assets/js/jquery.mCustomScrollbar.concat.min.js "></script>
    <!-- Chart js -->
    <script type="text/javascript" src="assets/js/chart.js/Chart.js"></script>
    <!-- amchart js -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="assets/pages/widget/amchart/gauge.js"></script>
    <script src="assets/pages/widget/amchart/serial.js"></script>
    <script src="assets/pages/widget/amchart/light.js"></script>
    <script src="assets/pages/widget/amchart/pie.min.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <!-- menu js -->
    <script src="assets/js/pcoded.min.js"></script>
    <script src="assets/js/vertical-layout.min.js "></script>
    <!-- custom js -->
    <script type="text/javascript" src="assets/pages/dashboard/custom-dashboard.js"></script>
    <script type="text/javascript" src="assets/js/script.js "></script>
    <script src="assets/js/morris-custom-chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <script src="dist/Chart.bundle.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"></script>
</body>

<script>
    var table = null;
    var chart = {};
    var phenodata = [];
    var imgName = [];
    var imgPath = [];
    var lineColor = {};
    const phnotypelabels = ["long_axis", "short_axis", "area", "convex_area", "center_x", "center_y"];

    function selectAll(selectAll) {
        var name;
        if (selectAll == "dataButton") name = "dataBox";
        else name = "labelBox";
        const checkboxes = document.querySelectorAll("input[name=" + name + "]");
        checkboxes.forEach((checkbox) => { $(checkbox).trigger("click"); })
    }


    function createCard(id) {
        var html = "";
        html += `<div class="card" id="` + id + `_card">
                    <div class="card-header">
                        <h5>` + id + `</h5>
                        <button id="export_` + id + `" class="btn btn-primary waves-effect waves-light" style="float: right; padding-bottom: 3px; padding-top: 3px;">내보내기</button>
                    </div>
                    <div class="card-block">
                        <div class="collapse show" id="chart_` + id + `">
                            <div class="col" style="border: 1px solid lightgray; padding: 15px; margin-bottom: 5px;">
                                <canvas id="` + id + `" style="height: 35vh; width: 100%;"></canvas>
                            </div>
                        </div>
                    </div>                                          
                </div>`
                
        $("#phenotypeCard").append(html);
    }


    const getOrCreateTooltip = (tooltipEl) => {
        if (!tooltipEl) {
            tooltipEl = document.createElement('div');
            tooltipEl.style.background = 'rgba(0, 0, 0, 0.7)';
            tooltipEl.style.borderRadius = '3px';
            tooltipEl.style.color = 'white';
            tooltipEl.style.pointerEvents = 'none';
            tooltipEl.style.position = 'absolute';
            tooltipEl.style.transform = 'translate(-50%, 0)';
            tooltipEl.style.transition = 'all .1s ease';
            const table = document.createElement('table');
            table.style.margin = '0px';
            tooltipEl.appendChild(table);
        }
        return tooltipEl;
    };
    var customTooltips = function(tooltip) {
    // Tooltip Element
        var tooltipEl = document.getElementById('chartjs-tooltip');
        if (!tooltipEl) {
            tooltipEl = getOrCreateTooltip(tooltipEl);
            tooltipEl.id = 'chartjs-tooltip';
            tooltipEl.innerHTML = "<table></table>"
            document.body.appendChild(tooltipEl);
        }
        // Hide if no tooltip
        if (tooltip.opacity === 0) {
            tooltipEl.style.opacity = 0;
            return;
        }
        // Set caret Position
        tooltipEl.classList.remove('above', 'below', 'no-transform');
        if (tooltip.yAlign) {
            tooltipEl.classList.add(tooltip.yAlign);
        } else {
            tooltipEl.classList.add('no-transform');
        }
        function getBody(bodyItem) {
            return bodyItem.lines;
        }
        // Set Text
        if (tooltip.body) {
            var titleLines = tooltip.title || [];
            var bodyLines = tooltip.body.map(getBody);
            //PUT CUSTOM HTML TOOLTIP CONTENT HERE (innerHTML)
            var innerHtml = '<thead >';
            titleLines.forEach(function(title) {
                innerHtml += '<tr><th>' + title + '</th></tr>';
            });
            innerHtml += '</thead><tbody>';
            bodyLines.forEach(function(body, i) {
                var colors = tooltip.labelColors[i];
                var style = 'background:' + colors.borderColor;
                style += '; width : 15px'; 
                style += '; height : 15px'; 
                style += ';border: 1px solid white';
                style += '; margin-right : 5px'
                style += '; padding-right : 5px'
                style += '; display  : inline-block'; 
                var span = '<span style="' + style + '"></span>';
                innerHtml += '<tr><td>' + span + " " + body[0].split(":")[0] + ': <span style="color:rgb(255, 120, 120)">' + body[0].split(":")[1] + '</span></td></tr>';
                
            });
            innerHtml += '</tbody>';
            var tableRoot = tooltipEl.querySelector('table');
            tableRoot.innerHTML = innerHtml;
            
        }
        var position = this._chart.canvas.getBoundingClientRect();
        tooltipEl.style.opacity = 1;
        tooltipEl.style.position = 'absolute';
        tooltipEl.style.left = position.left + window.pageXOffset + tooltip.caretX + 'px';
        tooltipEl.style.top = position.top + window.pageYOffset + tooltip.caretY + 'px';
        tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
        tooltipEl.style.fontSize = tooltip.bodyFontSize + 'px';
        tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
        tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
        tooltipEl.style.pointerEvents = 'none';
    };


    function createChart(id) {
        var ctx = document.getElementById(id).getContext('2d');
        chart[id] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [id],
                datasets: []
            },
            options: {
                tooltips: {
                    enabled: false,
                    mode: "index",
                    intersect: false,
                    custom: customTooltips
                },
                hover: {
                    mode: "nearest",
                    intersect: true,
                },
                esponsive: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                legend: { 
                    onHover: function (evt, element) {
                        if (element) {
                            
                            var ind = element.datasetIndex;
                            this.chart.config.data.datasets[ind].barPercentage = 1;
                            this.chart.config.data.datasets.map((dataset, index) => { dataset.backgroundColor = index == ind ? dataset.backgroundColor : dataset.backgroundColor.split(")")[0] + ',0.2)' })
                            this.chart.update();
                            this.chart.update();
                        }
                    },
                    onLeave: function(evt, element) {
                        if (element) {
                            
                            var ind = element.datasetIndex;
                            this.chart.config.data.datasets[ind].barPercentage = 0.5;
                            this.chart.config.data.datasets.map((dataset, index) => { dataset.backgroundColor = index == ind ? dataset.backgroundColor : dataset.backgroundColor.split(",0.2)")[0] + ')' })
                            this.chart.update();
                            this.chart.update();
                        }
                        
                    },
                    position: 'top',
                },
            }
        });

        $("#export_" + id).on('click', function(){ downloadChart(id); });
    }


    function createLabel(img) {
        $.each(img, (i, v) => {
            var html = "";
            html += `<label class="col-sm-6"><input type="checkbox" name="labelBox" id="` + v + `" value=""> ` + v + ` </label>`
            $("#label").append(html);

            $("#" + v).change(function(event) {
                $.each(phnotypelabels, (i2, v2) => { updateChart(this, i, v2); })
            })
        })
    }


    function updateChart(element, index, id) {
        var lbel = phenodata[index]["image"].split("/")[phenodata[index]["image"].split("/").length - 1].split(".")[0];
        if (lineColor[phenodata[index].Label_Name] == undefined) lineColor[phenodata[index].Label_Name] = Math.floor(Math.random() * 361) + "_" + Math.floor(Math.random() * 101);
        if (element.checked) {
            var randHSL = "hsla(" + lineColor[phenodata[index].Label_Name].split("_")[0] + ", " + lineColor[phenodata[index].Label_Name].split("_")[1]  + "%, " + (((Number(phenodata[index].Angle.split("SV")[1]) / 18) * 4) + 20) + "%)"      
            var newDataset = {
                label: lbel,
                backgroundColor: randHSL,
                borderColor: randHSL,
                barPercentage: 0.5,
                data: [phenodata[index][id]
                ],
            }
            chart[id].config.data.datasets.push(newDataset);
            chart[id].update();
        }
        else {
            var ind = chart[id].config.data.datasets.findIndex((v, i) => { return v.label == lbel; })
            if (ind != -1) chart[id].config.data.datasets.splice(ind, 1);
            chart[id].update();
        }
    }


    function uploadImage(path) {
        imgPath = [];
        imgPath.push(path);
        $.ajax({
            url: "/onloadImage",
            method: "get",
            data: {
                imagePath: path,
                wid: 1000,
            },
            success: function(data) {
                $('#selImg').html("");
                var html = `<img id='showImage' src="http://phenome.iptime.org:23000/users` + data + `" style="width: inherit;">`; // id로 구분??
                $('#selImg').append(html);
            }
        })
    }


    function modify_color() {
        $("#label_modal").html("");
        $.each(Object.keys(lineColor), (i, v) => {
            var html = `<label class="col-sm-3"><input type="checkbox" name="labelBoxModal" id="` + v + `_modal" value="` + (i + 1) + `"> ` + v + ` </label>`
            $("#label_modal").append(html);
        })
        $.each($("input:checkbox[name=labelBoxModal]"), (i, v) => { v.checked = false; })
        $("#labelModal").modal("show");
    }
    function applyLabelColor() {
        $.each($("input:checkbox[name=labelBoxModal]:checked"), (i, v) => {
            var label = v.id.split("_modal")[0];
            lineColor[label] = modal_hue.getValue() + "_" + modal_saturation.getValue();
            $.each(chart, (i, v) => {
                $.each(v.config.data.datasets, (i2, v2) => {
                    if (v2.label.split(label)[1] != undefined) {
                        var randHSL = "hsla(" + lineColor[label].split("_")[0] + ", " + lineColor[label].split("_")[1] + "%, " + (((Number(v2.label.split("SV")[1].split("_")[0]) / 18) * 3.5) + 20) + "%)"
                        v2.backgroundColor = randHSL;
                        v2.borderColor = randHSL;
                    }
                })
                v.update();
                v.update();
            })

        })    
    }

    function downloadChart(id) {
        var url = document.createElement('a'); 
        url.href = chart[id].toBase64Image();
        url.download = id + "_chart.png";
        url.click();
    }
    function downloadImage() { window.open("/exportImage?file=" +  JSON.stringify(imgPath)); }


    window.onload = function() { 
        var par = location.search.substr(location.search.indexOf("?") + 1);
        id = par.split("=")[1];


        $("#modify_chart_color").on('click', function() { modify_color(); })
        modal_hue = new Slider("#hue", {
            min: 0,
            max: 360,
            step: 1,
            value: 100
        });
        modal_hue.on('change', function(event) { $("#background_color").css("background", "hsl(" + modal_hue.getValue() + ", " + modal_saturation.getValue() + "%, 50%)") })
        modal_saturation = new Slider("#saturation", {
            min: 0,
            max: 100,
            step: 1,
            value: 100
        });
        modal_saturation.on('change', function(event) { $("#background_color").css("background", "hsl(" + modal_hue.getValue() + ", " + modal_saturation.getValue() + "%, 50%)") })


        $.each(phnotypelabels, function(i, v) {
            $("#datacheck_" + (i + 1)).on('click', function() {
                if ($("#datacheck_" + (i + 1)).prop('checked')) $("#" + v + "_card").css("display", "");
                else $("#" + v + "_card").css("display", "none");
            })
        })
        
        $.ajax({
            url: "/onloadChart",
            method: "post",
            data: {
                res_id: id
            },
            success: function(data) {
                $("#table_body").html("");

                table = $("#tableId").DataTable({
                    dom: 'Bfrtip',
                    buttons: ['csv']
                });
                table.clear();

                $.each(data, (i, v) => {
                    var temp = v["Image_Path"].split("/")[v["Image_Path"].split("/").length - 1].split(".")[0];
                    table.row.add([
                        (i + 1),
                        temp,
                        v["long_axis"],
                        v["short_axis"],
                        v["area"],
                        v["convex_area"],
                        v["center_x"],
                        v["center_y"],
                        v["Image_Path"]
                    ]);                  
                    phenodata.push({
                        Label_Name: v["Label_Name"],
                        image: v["Image_Path"],
                        Angle: v["Angle"],
                        long_axis: v["long_axis"],
                        short_axis: v["short_axis"],
                        area: v["area"],
                        convex_area: v["convex_area"],
                        center_x: v["center_x"],
                        center_y: v["center_y"],
                        time: v["time"]
                    });
                    
                    imgName.push(temp);
                    
                    if (data.length - 1 == i) {
                        table.draw();
                        $("#tableId").on('click', 'tbody tr', function() {
                            var row = table.row($(this)).data();
                            uploadImage(row[8]);
                        })
                    }
                })

                $.each(phnotypelabels, (i, v) => { 
                    createCard(v); 
                    createChart(v);
                    $("#" + v + "_card").css("display", "none");
                }) 
                phenodata = phenodata.sort(function(a, b) { 
                    let x = a.image.toLowerCase();
                    let y = b.image.toLowerCase();
                    if (x < y)  return -1;
                    else if (x > y) return 1;
                    return 0;
                })
                imgName.sort();
                createLabel(imgName);

            }

        });
    }
</script>

</html>

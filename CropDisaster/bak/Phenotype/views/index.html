<!DOCTYPE html>
<html lang="en">

<head>
    <title>피노타이핑 데이터 분석 가시화 시스템</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="Mega Able Bootstrap admin template made using Bootstrap 4 and it has huge amount of ready made feature, UI components, pages which completely fulfills any dashboard needs." />
    <meta name="keywords" content="bootstrap, bootstrap admin template, admin theme, admin dashboard, dashboard template, admin template, responsive" />
    <meta name="author" content="codedthemes" />
    <!-- Favicon icon -->
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon" />
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet" />
    <!-- waves.css -->
    <link rel="stylesheet" href="assets/pages/waves/css/waves.min.css" type="text/css" media="all" />
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap/css/bootstrap.min.css" />
    <!-- waves.css -->
    <link rel="stylesheet" href="assets/pages/waves/css/waves.min.css" type="text/css" media="all" />
    <!-- themify icon -->
    <link rel="stylesheet" type="text/css" href="assets/icon/themify-icons/themify-icons.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" type="text/css" href="assets/icon/font-awesome/css/font-awesome.min.css" />
    <!-- scrollbar.css -->
    <link rel="stylesheet" type="text/css" href="assets/css/jquery.mCustomScrollbar.css" />
    <!-- am chart export.css -->
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="/resources/demos/style.css" />
    <link href="css/bootstrap.css" rel="stylesheet" />
</head>

<body>
    <!-- Pre-loader start -->
    <div class="theme-loader">
        <div class="loader-track">
            <div class="preloader-wrapper">
                <div class="spinner-layer spinner-blue">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
                <div class="spinner-layer spinner-red">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>

                <div class="spinner-layer spinner-yellow">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>

                <div class="spinner-layer spinner-green">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pre-loader end -->
    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            <nav class="navbar header-navbar pcoded-header">
                <div class="navbar-wrapper">
                    <div class="navbar-logo">
                        <a class="mobile-menu waves-effect waves-light" id="mobile-collapse" href="#!">
                            <i class="ti-menu"></i>
                        </a>
                        <div class="mobile-search waves-effect waves-light">
                            <div class="header-search">
                                <div class="main-search morphsearch-search">
                                    <div class="input-group">
                                        <span class="input-group-addon search-close"><i class="ti-close"></i></span>
                                        <input type="text" class="form-control" placeholder="Enter Keyword" />
                                        <span class="input-group-addon search-btn"><i class="ti-search"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="/">
                            <!-- <img class="img-fluid" src="assets/images/logo.png" alt="Theme-Logo" /> -->
                            <h5>메인화면</h5>
                        </a>
                        <a class="mobile-options waves-effect waves-light">
                            <i class="ti-more"></i>
                        </a>
                    </div>
                </div>
            </nav>

            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <nav class="pcoded-navbar">
                        <div class="sidebar_toggle">
                            <a href="#"><i class="icon-close icons"></i></a>
                        </div>
                        <div class="pcoded-inner-navbar main-menu">
                            <div class="pcoded-navigation-label" data-i18n="nav.category.navigation">Layout</div>
                            <ul class="pcoded-item pcoded-left-item">
                                <li class="active">
                                    <a href="/" class="waves-effect waves-dark">
                                        <span class="pcoded-micon"><i class="ti-home"></i><b>연구정리</b></span>
                                        <span class="pcoded-mtext" data-i18n="nav.dash.main">연구 정리</span>
                                        <span class="pcoded-mcaret"></span>
                                    </a>
                                </li>

                                <li>
                                    <a href="/search" class="waves-effect waves-dark">
                                        <span class="pcoded-micon"><i class="ti-search"></i><b>D</b></span>
                                        <span class="pcoded-mtext" data-i18n="nav.dash.main">연구 검색</span>
                                        <span class="pcoded-mcaret"></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                    <div class="pcoded-content">
                        <!-- Page-header start -->
                        <div class="page-header">
                            <div class="page-block">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="page-header-title">
                                            <h5 class="m-b-10">피노타이핑 데이터 분석 및 가시화 시스템</h5>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <ul class="breadcrumb-title">
                                            <li class="breadcrumb-item">
                                                <a href="/"> <i class="fa fa-home"></i> </a>
                                            </li>
                                            <li class="breadcrumb-item"><a href="#!">연구 정리</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="pcoded-inner-content">
                            <!-- Main-body start -->
                            <div class="main-body">
                                <div class="page-wrapper">
                                    <!-- Page-body start -->
                                    <div class="page-body">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <!-- Basic Form Inputs card start -->
                                                <div class="card">
                                                    <div class="card-header">
                                                        <h5>연구 데이터 업로드</h5>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="form-group row">
                                                            <div class="col-sm-4">
                                                                <!-- <label class="btn btn-primary waves-effect waves-light" for="directory_upload">폴더 선택</label>
                                                                <input type="file" id="directory_upload" style="display:none;" webkitdirectory> -->
                                                                <!-- <div id="file_list"></div> -->

                                                                <div class="row">
                                                                    <div class="col">
                                                                        <h4 class="sub-title">업로드 데이터 선택</h4>
                                                                        <div id="treeview-checkable" class=""></div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-sm-8">
                                                                <h4 class="sub-title">업로드 데이터 입력</h4>
                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">연구 종</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" id="species" name="species" class="form-control" maxlength="45" />
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">실험 목적</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" id="res_purpose" name="res_purpose" class="form-control" maxlength="100" />
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">실험 종류</label>
                                                                    <div class="col-sm-10">
                                                                        <select id="res_type" name="res_type" class="form-control">
                                                                            <option value="0">없음</option>
                                                                            <option value="1">건조</option>
                                                                            <option value="2">고온</option>
                                                                            <option value="3">형태</option>
                                                                            <option value="4">색상</option>
                                                                            <option value="5">기타</option>
                                                                        </select>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">실험 이름</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" id="res_name" name="res_name" class="form-control" maxlength="100" />
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">관리자</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" id="admin" name="admin" class="form-control" maxlength="45" />
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">실험 날짜</label>
                                                                    <div class="col-sm-10">
                                                                        <div class="form-group row" style="margin-left: 0px; margin-right: 0px">
                                                                            <input type="text" name="res_stdate" id="res_stdate" class="col-sm-5 form-control" autocomplete="off">
                                                                            <label class="col-sm-2 col-form-label" style="text-align: center"> ~ </label>
                                                                            <input type="text" name="res_eddate" id="res_eddate" class="col-sm-5 form-control" autocomplete="off">
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group row">
                                                                    <label class="col-sm-2 col-form-label">타입</label>
                                                                    <div class="col-sm-10">
                                                                        <select name="type" class="form-control">
                                                                                <option value="1">종자</option>
                                                                                <option value="2">식물</option>
                                                                            </select>
                                                                    </div>
                                                                </div>

                                                                <button type="" onclick="upload()" id="upload_button" class="btn btn-primary waves-effect waves-light" style="float: right">업로드</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- row end -->
                                    </div>
                                    <!-- Page-body end -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Required Jquery -->
    <script type="text/javascript" src="assets/js/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery-ui/jquery-ui.min.js "></script>
    <script type="text/javascript" src="assets/js/popper.js/popper.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap/js/bootstrap.min.js "></script>
    <script type="text/javascript" src="assets/pages/widget/excanvas.js "></script>
    <!-- waves js -->
    <script src="assets/pages/waves/js/waves.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="assets/js/jquery-slimscroll/jquery.slimscroll.js "></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="assets/js/modernizr/modernizr.js "></script>
    <!-- slimscroll js -->
    <script type="text/javascript" src="assets/js/SmoothScroll.js"></script>
    <script src="assets/js/jquery.mCustomScrollbar.concat.min.js "></script>
    <!-- Chart js -->
    <script type="text/javascript" src="assets/js/chart.js/Chart.js"></script>
    <!-- amchart js -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="assets/pages/widget/amchart/gauge.js"></script>
    <script src="assets/pages/widget/amchart/serial.js"></script>
    <script src="assets/pages/widget/amchart/light.js"></script>
    <script src="assets/pages/widget/amchart/pie.min.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <!-- menu js -->
    <script src="assets/js/pcoded.min.js"></script>
    <script src="assets/js/vertical-layout.min.js "></script>
    <!-- custom js -->
    <!-- <script type="text/javascript" src="assets/pages/dashboard/custom-dashboard.js"></script> -->
    <script type="text/javascript" src="assets/js/script.js "></script>
    <script src="js/bootstrap-treeview.js"></script>

    <script>
        var temp = {}
        var $checkableTree = null

        function getTree(data) {
            $checkableTree = $("#treeview-checkable").treeview({
                data: data,
                showIcon: true,
                showCheckbox: true,
                onNodeChecked: function(event, node) {
                    function check(nodes) {
                        if (nodes.nodes != undefined) {
                            $.each(nodes.nodes, (i, v) => {
                                $checkableTree.treeview("checkNode", [v.nodeId, {
                                    silent: true
                                }])
                                if (v.nodes != undefined) {
                                    check(v)
                                }
                            })
                        }
                    }
                    check(node)
                },
                onNodeSelected: function(event, node) {
                    var te_arr = []
                    if (node.text.indexOf("More") != -1) {
                        var par_id = node.href.split("_")[0]
                        var parnode = $checkableTree.treeview("getNode", [node.parentId])
                        var flag = parnode.state.checked
                        $.each([...Array(15)], (i, v) => {
                            te_arr.push(temp[par_id].shift())
                            if (i == 14) {
                                $.each(te_arr, (i, v) => {
                                    if (flag) {
                                        v["state"] = {
                                            checked: true
                                        }
                                        $checkableTree.treeview("addNode", [node.parentId, {
                                                node: v
                                            }])
                                            // $checkableTree.treeview("checkNode", [v.nodeId, { silent: true }])
                                    } else {
                                        $checkableTree.treeview("addNode", [node.parentId, {
                                            node: v
                                        }])
                                    }
                                    if (i == te_arr.length - 1) {
                                        if (temp[par_id].length != 0) {
                                            if (flag) {
                                                $checkableTree.treeview("addNode", [
                                                    node.parentId, {
                                                        node: {
                                                            text: "... " + temp[par_id].length + " More Files",
                                                            href: par_id + "_" + parnode.text,
                                                            state: {
                                                                checked: true
                                                            }
                                                        }
                                                    },
                                                ])
                                            } else {
                                                $checkableTree.treeview("addNode", [
                                                    node.parentId, {
                                                        node: {
                                                            text: "... " + temp[par_id].length + " More Files",
                                                            href: par_id + "_" + parnode.text
                                                        }
                                                    },
                                                ])
                                            }
                                        }
                                        $checkableTree.treeview("deleteNode", [node.nodeId])
                                    }
                                })
                            }
                        })
                    }
                },
                onNodeUnchecked: function(event, node) {
                    function uncheck(nodes) {
                        if (nodes.nodes != undefined) {
                            $.each(nodes.nodes, (i, v) => {
                                $checkableTree.treeview("uncheckNode", [v.nodeId, {
                                    silent: true
                                }])
                                if (v.nodes != undefined) {
                                    uncheck(v)
                                }
                            })
                        }
                    }

                    function uncheckParent(nodes) {
                        $checkableTree.treeview("uncheckNode", [nodes.parentId, {
                            silent: true
                        }])
                        uncheckParent($checkableTree.treeview("getNode", [nodes.parentId]))
                    }
                    uncheck(node)
                    if (node.parentId != undefined) {
                        uncheckParent(node)
                    }
                },
                onNodeExpanded: function(event, node) {
                    if (node.nodes.length == 0) {
                        $.ajax({
                            url: "/searchFile",
                            data: {
                                folder: node.href,
                            },
                            method: "get",
                            success: function(data) {
                                $.each(data, (i, v) => {
                                    if (i > 14) {
                                        if (i == 15) {
                                            temp[node.nodeId] = []
                                            if ($checkableTree.treeview("getNode", node.nodeId).state.checked) {
                                                $checkableTree.treeview("addNode", [
                                                    node.nodeId, {
                                                        node: {
                                                            text: "... " + (data.length - 15) + " More Files",
                                                            href: node.nodeId + "_" + node.text,
                                                            state: {
                                                                checked: true
                                                            }
                                                        }
                                                    },
                                                ])
                                            } else {
                                                $checkableTree.treeview("addNode", [
                                                    node.nodeId, {
                                                        node: {
                                                            text: "... " + (data.length - 15) + " More Files",
                                                            href: node.nodeId + "_" + node.text
                                                        }
                                                    },
                                                ])
                                            }
                                        }
                                        temp[node.nodeId].push(v)
                                    } else {
                                        if ($checkableTree.treeview("getNode", node.nodeId).state.checked) {
                                            v["state"] = { checked: true }
                                            $checkableTree.treeview("addNode", [node.nodeId, { node: v }])
                                        } else {
                                            $checkableTree.treeview("addNode", [node.nodeId, { node: v }])
                                        }
                                    }
                                })
                            },
                        })
                    }
                },
            })
        }

        window.onload = function() {
            $.ajax({
                url: "/searchFile",
                data: {
                    folder: "/",
                },
                method: "get",
                success: function(data) {
                    getTree(data)
                },
            })
        }

        function upload() {
            var tempNodes = $("#treeview-checkable").treeview("getChecked");
            var nodes = []; // 실질 사용 노드
            var nodesData = [];
            var par_id;
            var tempCnt = 0;

            $.each(tempNodes, function(i, v) {
                if (nodes.indexOf(v) == -1) {
                    if (v.parentId == undefined && v.state.checked) {
                        nodes.push(v);
                        nodesData.push(v.href);
                    }
                    else if (!$("#treeview-checkable").treeview("getNode", [v.parentId]).state.checked) {
                        if (v.text.indexOf("More") != -1) {
                            par_id = v.href.split("_")[0]
                            $.each(temp[par_id], function(i, v) { 
                                nodesData.push(v.href); 
                                tempCnt++;
                            });
                        }
                        else {
                            nodes.push(v);
                            nodesData.push(v.href);
                        }
                    }
                    
                }
            });

           if ((nodes.length + tempCnt) == nodesData.length) {
                $.ajax({
                    url: "/Upload_Data",
                    method: "post",
                    dataType: "json",
                    data: {
                        species: $("#species").val(),
                        res_purpose: $("#res_purpose").val(),
                        res_type: $("#res_type").val(),
                        admin: $("#admin").val(),
                        res_stdate: $("#res_stdate").val(),
                        res_eddate: $("#res_eddate").val(),
                        res_name: $("#res_name").val(),
                        type: $("#type").val(),
                        node: JSON.stringify(nodesData)
                    },
                    success: function(data) { 
                        console.log("data : " + data);
                    }
                })
                $("#species").val("");
                $("#species").val("");
                $("#res_purpose").val("");
                $("#admin").val("");
                $("#res_stdate").val("");
                $("#res_eddate").val("");
                $("#res_name").val("");
                $("#type").val("");
            }
        }

        $(function() { $("#res_stdate").datepicker({ dateFormat: "yy-mm-dd", }) })
        $(function() { $("#res_eddate").datepicker({ dateFormat: "yy-mm-dd", }) })
    </script>
</body>

</html>